# Verify OpenSpec Implementation

Comprehensive verification of an OpenSpec change implementation including E2E testing, documentation completeness, and gap identification using swarm orchestration.

---

## MANDATORY EXECUTION RULES - NO EXCEPTIONS

**YOU ARE FORBIDDEN FROM:**
- Performing verification manually yourself
- Skipping swarm initialization
- Taking shortcuts or "just doing it yourself"
- Running E2E tests without spawning tester agents

**YOU MUST:**
- Initialize the swarm FIRST
- Spawn tester and reviewer agents to perform verification
- Let agents do ALL the verification work
- Only aggregate and report results

**IF YOU SKIP THESE STEPS, YOU ARE FAILING YOUR CORE RESPONSIBILITY.**

The entire point of this system is multi-agent orchestration. If you verify directly, you defeat the purpose and waste the infrastructure that was built.

---

## Task

### Step 1: Ask for CHANGE_ID if not provided

### Step 2: Initialize Swarm (MANDATORY - DO THIS NOW)

**IMMEDIATELY** call this MCP tool - no exceptions:

```
mcp__claude-flow__swarm_init({
  topology: "star",
  maxAgents: 4,
  strategy: "adaptive"
})
```

**DO NOT PROCEED WITHOUT SWARM INITIALIZATION.**

### Step 3: Load Context (READ ONLY - FOR AGENTS)

Load these files to pass to verification agents:
- `openspec/changes/<CHANGE_ID>/work-brief.md`
- `openspec/changes/<CHANGE_ID>/proposal.md`
- `openspec/changes/<CHANGE_ID>/tasks.md`
- `openspec/changes/<CHANGE_ID>/flow-log.md` (if exists)
- `CLAUDE.md`
- `CLAUDE-FLOW.md`

### Step 4: Run Pre-Verification Checks

Run build verification:
```bash
{{build.full_command}}
```

Run type check (if frontend changes):
```bash
# Run type-check command for frontend
```

### Step 5: Spawn Verification Agents (MANDATORY - DO THIS NOW)

**IMMEDIATELY** spawn the verification agents using the Task tool:

```
Task({
  subagent_type: "tester",
  description: "E2E verify OpenSpec <CHANGE_ID> implementation",
  prompt: <TESTER PROMPT BELOW>
})

Task({
  subagent_type: "reviewer",
  description: "Documentation and gap analysis for <CHANGE_ID>",
  prompt: <REVIEWER PROMPT BELOW>
})
```

**YOU DO NOT VERIFY ANYTHING DIRECTLY - THE AGENTS DO ALL THE WORK.**

### Step 6: Monitor and Collect Results

While agents run:
- Check `mcp__claude-flow__swarm_status` periodically
- Do NOT intervene unless agent requests help

After agents complete:
- Collect verification reports from agents
- Aggregate into `openspec/changes/<CHANGE_ID>/verification-report.md`
- Present summary to user

### Step 7: Cleanup Swarm

```
mcp__claude-flow__swarm_destroy({ swarmId: "<swarm-id>" })
```

---

## TESTER AGENT PROMPT

```
You are a Tester Agent for OpenSpec change: <CHANGE_ID>

## YOUR MISSION
Perform comprehensive E2E verification of the implementation.

## CONTEXT
<INSERT work-brief.md, proposal.md, tasks.md CONTENT>

## PRE-VERIFICATION
1. Confirm build passes: `{{build.full_command}}`
2. Confirm type check passes (if frontend): `npm run type-check`
3. Review tasks.md for completion status

## E2E TESTING WITH PLAYWRIGHT MCP

1. **Ask user to start application**:
   ```
   Please start the application:
   {{run.full_command}}
   ```

2. **Wait for user confirmation** that services are ready

3. **Use Playwright MCP tools** to verify:
   - `mcp__playwright__browser_navigate` - Navigate to pages
   - `mcp__playwright__browser_snapshot` - Capture accessibility tree
   - `mcp__playwright__browser_click` - Interact with elements
   - `mcp__playwright__browser_type` - Fill forms

4. **Test endpoints**:
   - API: `http://localhost:{{run.port}}/api/...`
   - Frontend: Check project frontend port

## OUTPUT FORMAT
Provide verification report with:
1. **Build Status**: PASS/FAIL
2. **E2E Test Results**: List of scenarios tested and results
3. **Gaps Identified**: Critical/Major/Minor issues
4. **Recommendations**: Next steps
```

---

## REVIEWER AGENT PROMPT

```
You are a Documentation Reviewer Agent for OpenSpec change: <CHANGE_ID>

## YOUR MISSION
Verify documentation completeness and identify gaps.

## CONTEXT
<INSERT work-brief.md, proposal.md, tasks.md CONTENT>

## VERIFICATION CHECKLIST

### Documentation Completeness
- [ ] All tasks in tasks.md marked complete
- [ ] Flow log exists and is complete
- [ ] Code comments where needed
- [ ] API documentation updated (if applicable)

### Gap Analysis
- **Critical gaps**: Must be fixed before marking complete
- **Major gaps**: Should be addressed or documented as follow-up
- **Minor gaps**: Can be deferred with documentation

### Follow-up Changes
Identify any items that need new OpenSpec changes created.

## OUTPUT FORMAT
Provide documentation review with:
1. **Completeness Score**: X/Y items complete
2. **Gaps Found**: List with severity
3. **Follow-up Recommendations**: New changes needed
```

---

## VERIFICATION CHECKLIST

Before considering this command complete, verify:

- [ ] `mcp__claude-flow__swarm_init` was called
- [ ] Task tool spawned tester agent
- [ ] Task tool spawned reviewer agent
- [ ] NO manual verification was performed by the main assistant
- [ ] Verification report was generated
- [ ] `mcp__claude-flow__swarm_destroy` was called for cleanup

**If any checkbox is unchecked, the command was executed incorrectly.**

---

## Post-Verification

After successful verification:
1. Review the generated verification report
2. Address any critical gaps
3. Proceed to archive: `/openspec:archive` or run `openspec archive <CHANGE_ID>`

## Related Commands

- `/openspec-flow:work` - Generate work brief
- `/openspec-flow:implement` - Implement the change
- `/openspec-flow:deferred` - Analyze deferred items
