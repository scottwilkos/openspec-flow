# Review OpenSpec Implementation

Review an implementation against the OpenSpec change and architecture requirements using swarm orchestration.

---

## MANDATORY EXECUTION RULES - NO EXCEPTIONS

**YOU ARE FORBIDDEN FROM:**
- Performing the review manually yourself
- Skipping swarm initialization
- Taking shortcuts or "just doing it yourself"
- Reviewing code without spawning reviewer agents

**YOU MUST:**
- Initialize the swarm FIRST
- Spawn reviewer agent(s) to perform the actual review
- Let agents do ALL the review work
- Only aggregate and report results

**IF YOU SKIP THESE STEPS, YOU ARE FAILING YOUR CORE RESPONSIBILITY.**

The entire point of this system is multi-agent orchestration. If you review directly, you defeat the purpose and waste the infrastructure that was built.

---

## Task

### Step 1: Ask for CHANGE_ID if not provided

### Step 2: Initialize Swarm (MANDATORY - DO THIS NOW)

**IMMEDIATELY** call this MCP tool - no exceptions:

```
mcp__claude-flow__swarm_init({
  topology: "star",
  maxAgents: 4,
  strategy: "adaptive"
})
```

**DO NOT PROCEED WITHOUT SWARM INITIALIZATION.**

### Step 3: Load Context (READ ONLY - FOR AGENTS)

Load these files to pass to reviewer agents:
- `openspec/changes/<CHANGE_ID>/work-brief.md`
- `openspec/changes/<CHANGE_ID>/proposal.md`
- `openspec/changes/<CHANGE_ID>/tasks.md`
- `CLAUDE.md`
- `CLAUDE-FLOW.md`

### Step 4: Spawn Reviewer Agent (MANDATORY - DO THIS NOW)

**IMMEDIATELY** spawn the reviewer agent using the Task tool:

```
Task({
  subagent_type: "reviewer",
  description: "Review OpenSpec <CHANGE_ID> implementation",
  prompt: <REVIEWER PROMPT BELOW>
})
```

**YOU DO NOT REVIEW ANYTHING DIRECTLY - THE REVIEWER AGENT DOES ALL THE WORK.**

### Step 5: Monitor and Collect Results

While reviewer agent runs:
- Check `mcp__claude-flow__swarm_status` periodically
- Do NOT intervene unless agent requests help

After agent completes:
- Collect the review report from the agent
- Present summary to user

### Step 6: Cleanup Swarm

```
mcp__claude-flow__swarm_destroy({ swarmId: "<swarm-id>" })
```

---

## REVIEWER AGENT PROMPT

```
You are a Reviewer Agent for OpenSpec change: <CHANGE_ID>

## YOUR MISSION
Review the implementation against the OpenSpec specification and architecture requirements.

## CONTEXT
<INSERT work-brief.md, proposal.md, tasks.md CONTENT>

## FILES TO REVIEW
Find and analyze implemented files in these locations:
- `{{paths.source.domain}}/`
- `{{paths.source.application}}/`
- `{{paths.source.infrastructure}}/`
- `{{paths.source.endpoints}}/`
- `{{paths.tests.unit}}/`

## REVIEW CHECKLIST

### Requirements Alignment
- [ ] All tasks from work brief completed
- [ ] Spec requirements met
- [ ] No missing functionality

### Constraints Compliance
{{#each constraints}}
- [ ] {{this}}
{{/each}}

### Code Patterns
{{#each patterns}}
- [ ] {{this}}
{{/each}}

### Database
- [ ] Migrations created (if needed)
- [ ] Indexes on foreign keys
- [ ] No N+1 queries

### Security & Compliance
- [ ] Endpoints require authorization
- [ ] No hardcoded credentials
- [ ] Proper error handling

### Code Quality
- [ ] No magic strings
- [ ] Explicit naming
- [ ] Proper error handling
- [ ] Tests written

## OUTPUT FORMAT

Provide a structured review report:
1. **Summary**: Overall assessment (PASS/FAIL/NEEDS WORK)
2. **Passed Checks**: List of items that passed
3. **Failed Checks**: List with file:line references
4. **Warnings**: Non-blocking concerns
5. **Recommendations**: Suggested improvements
```

---

## VERIFICATION CHECKLIST

Before considering this command complete, verify:

- [ ] `mcp__claude-flow__swarm_init` was called
- [ ] Task tool spawned reviewer agent
- [ ] NO manual review was performed by the main assistant
- [ ] Review report was generated by the agent
- [ ] `mcp__claude-flow__swarm_destroy` was called for cleanup

**If any checkbox is unchecked, the command was executed incorrectly.**
